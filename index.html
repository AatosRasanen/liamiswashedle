<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIAMISWASHEDLE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
            background-color: #0a192f; /* Dark Navy Blue */
            background-image: radial-gradient(circle at top right, rgba(13, 110, 253, 0.2), transparent 40%),
                              radial-gradient(circle at bottom left, rgba(0, 255, 255, 0.15), transparent 50%);
        }
        .modal-bg {
            background-color: rgba(10, 25, 47, 0.8);
            backdrop-filter: blur(5px);
        }
        .animate-reveal {
            animation: reveal 0.5s ease-out forwards;
        }
        @keyframes reveal {
            from {
                transform: scale(0.9);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Frutiger Aero / Glossy Style */
        .glossy-button {
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 9999px;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.4);
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2), inset 0 1px 1px rgba(255,255,255,0.3);
            background-color: rgba(0,0,0,0.1); /* Base for transparency */
        }
        .glossy-button:hover {
            transform: translateY(-2px);
            /* Inner glow effect on hover */
            box-shadow: 0 6px 12px rgba(0,0,0,0.3), 
                        inset 0 0 10px rgba(0, 255, 255, 0.5),
                        inset 0 1px 1px rgba(255,255,255,0.3);
        }
        .play-button-gloss {
            background-image: radial-gradient(circle at 50% 30%, rgba(79, 70, 229, 0.85), rgba(14, 165, 233, 0.85));
        }
         .submit-button-gloss {
            background-image: linear-gradient(180deg, rgba(34, 197, 94, 0.85), rgba(21, 128, 61, 0.85));
        }
        .skip-button-gloss {
            background-image: linear-gradient(180deg, rgba(107, 114, 128, 0.85), rgba(75, 85, 99, 0.85));
        }

        .main-title {
            font-weight: 800;
            color: #e2e8f0;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.3), 0 0 10px rgba(0, 255, 255, 0.2);
        }

        .card-bg {
            background-color: rgba(23, 37, 62, 0.7); /* Slightly lighter navy for cards */
            border: 1px solid rgba(0, 191, 255, 0.2);
            border-radius: 1rem;
            box-shadow: 0 8px 32px 0 rgba(0,0,0,0.37);
        }

        .autocomplete-items {
            border: 1px solid rgba(0, 191, 255, 0.2);
            border-top: none;
            z-index: 99;
            top: 100%;
            left: 0;
            right: 0;
            border-bottom-left-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
            overflow: hidden;
        }
        .autocomplete-items div {
            padding: 12px;
            cursor: pointer;
            background-color: #1e293b;
            transition: background-color 0.2s;
        }
        .autocomplete-items div:not(:last-child) {
             border-bottom: 1px solid rgba(0, 191, 255, 0.1);
        }
        .autocomplete-items div:hover {
            background-color: #334155;
        }
        
        .progress-bar-container {
            width: 100%;
            height: 10px;
            background-color: rgba(0,0,0,0.3);
            border-radius: 5px;
            overflow: hidden;
            margin-top: 1rem;
            border: 1px solid rgba(0, 191, 255, 0.2);
        }
        .progress-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #00bfff, #00ffc4);
            transition: width 0.1s linear;
        }

        .guess-square {
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 191, 255, 0.1);
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <div id="game-container" class="w-full max-w-md mx-auto">
        <!-- Header -->
        <header class="flex justify-between items-center py-4">
             <!-- Spacer for centering the title -->
            <div class="w-20"></div>
            <h1 class="text-3xl tracking-tight main-title text-center">LIAMISWASHEDLE</h1>
            <div class="w-20 flex justify-end items-center space-x-4 text-slate-300">
                <button id="how-to-play-btn" aria-label="How to play" class="hover:text-cyan-300 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                </button>
                <button id="stats-btn" aria-label="Statistics" class="hover:text-cyan-300 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>
                </button>
            </div>
        </header>

        <!-- Game Area -->
        <main class="py-8">
            <!-- Guesses Visualizer -->
            <div id="guesses-container" class="flex justify-center items-center space-x-2 mb-6">
                <!-- Guess squares will be dynamically inserted here -->
            </div>

            <!-- Audio Player -->
            <div id="audio-player-container" class="mb-6">
                <audio id="audio-player" class="hidden" preload="metadata"></audio>
                <div class="flex items-center justify-center space-x-4">
                     <button id="play-pause-btn" class="glossy-button play-button-gloss font-bold py-3 px-3 rounded-full flex items-center justify-center w-20 h-20">
                        <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                        </svg>
                         <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 hidden" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1zm4 0a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
                 <div class="progress-bar-container">
                    <div id="progress-bar" class="progress-bar"></div>
                </div>
            </div>
            
            <!-- Input Form -->
            <div id="input-container" class="relative">
                <div class="autocomplete w-full">
                    <input id="guess-input" type="text" placeholder="Type song title..." class="w-full bg-slate-800 border-2 border-slate-700 rounded-lg px-4 py-3 text-slate-200 placeholder-slate-400 focus:outline-none focus:border-cyan-400 transition-colors">
                    <div id="autocomplete-list" class="autocomplete-items absolute hidden"></div>
                </div>
                <div class="flex justify-center space-x-4 mt-4">
                    <button id="skip-btn" class="glossy-button skip-button-gloss font-bold py-2 px-8 rounded-lg">Skip</button>
                    <button id="submit-btn" class="glossy-button submit-button-gloss font-bold py-2 px-8 rounded-lg">Submit</button>
                </div>
            </div>

            <!-- Result Display -->
            <div id="result-container" class="text-center mt-8 hidden animate-reveal card-bg p-6">
                 <h2 id="result-message" class="text-2xl font-bold"></h2>
                 <p id="correct-song-title" class="text-xl mt-2 text-slate-200"></p>
                 <div id="album-art-container" class="mt-4 flex justify-center"></div>
                 <p class="mt-4 text-slate-300">Have I just wasted my time with this? Yes, but at the expense of seeing Liam suffer!</p>
                 <button id="share-btn" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition-colors flex items-center mx-auto">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                         <path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z" />
                     </svg>
                     Fked it
                 </button>
                 <div id="share-feedback" class="text-sm mt-2 text-green-400"></div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="how-to-play-modal" class="fixed inset-0 modal-bg flex items-center justify-center hidden p-4">
        <div class="card-bg p-6 w-full max-w-md relative">
            <button id="close-how-to-play-modal" class="absolute top-4 right-4 text-slate-400 hover:text-white">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <h2 class="text-2xl font-bold mb-4 text-cyan-300">How To Play</h2>
            <div class="space-y-3 text-slate-300">
                <p>Guess the song in 5 tries.</p>
                <p>Each incorrect or skipped guess reveals more of the song.</p>
                <p>The snippets get progressively longer:</p>
                <ul class="list-disc list-inside pl-4">
                    <li>Guess 1: 1 second</li>
                    <li>Guess 2: 2 seconds</li>
                    <li>Guess 3: 4 seconds</li>
                    <li>Guess 4: 8 seconds</li>
                    <li>Guess 5: 16 seconds</li>
                </ul>
                <p>Guess the Le Sserafim song, Liam... it's easy</p>
            </div>
        </div>
    </div>
    
    <div id="stats-modal" class="fixed inset-0 modal-bg flex items-center justify-center hidden p-4">
        <div class="card-bg p-6 w-full max-w-md relative">
            <button id="close-stats-modal" class="absolute top-4 right-4 text-slate-400 hover:text-white">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <h2 class="text-2xl font-bold mb-4 text-center text-cyan-300">Statistics</h2>
            <div class="flex justify-around text-center mb-6 text-slate-200">
                <div>
                    <p id="stats-played" class="text-3xl font-bold">0</p>
                    <p class="text-sm text-slate-400">Played</p>
                </div>
                <div>
                    <p id="stats-win-rate" class="text-3xl font-bold">0</p>
                    <p class="text-sm text-slate-400">Win %</p>
                </div>
                <div>
                    <p id="stats-current-streak" class="text-3xl font-bold">0</p>
                    <p class="text-sm text-slate-400">Current Streak</p>
                </div>
                <div>
                    <p id="stats-max-streak" class="text-3xl font-bold">0</p>
                    <p class="text-sm text-slate-400">Max Streak</p>
                </div>
            </div>
            <h3 class="text-lg font-bold mb-2 text-center text-slate-200">Guess Distribution</h3>
            <canvas id="stats-chart" width="400" height="200"></canvas>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- DOM Elements ---
    const gameContainer = document.getElementById('game-container');
    const guessesContainer = document.getElementById('guesses-container');
    const audioPlayer = document.getElementById('audio-player');
    const playPauseBtn = document.getElementById('play-pause-btn');
    const playIcon = document.getElementById('play-icon');
    const pauseIcon = document.getElementById('pause-icon');
    const progressBar = document.getElementById('progress-bar');
    const guessInput = document.getElementById('guess-input');
    const autocompleteList = document.getElementById('autocomplete-list');
    const skipBtn = document.getElementById('skip-btn');
    const submitBtn = document.getElementById('submit-btn');
    const inputContainer = document.getElementById('input-container');
    const resultContainer = document.getElementById('result-container');
    const resultMessage = document.getElementById('result-message');
    const correctSongTitle = document.getElementById('correct-song-title');
    const albumArtContainer = document.getElementById('album-art-container');
    const shareBtn = document.getElementById('share-btn');
    const shareFeedback = document.getElementById('share-feedback');

    // Modals
    const howToPlayBtn = document.getElementById('how-to-play-btn');
    const statsBtn = document.getElementById('stats-btn');
    const howToPlayModal = document.getElementById('how-to-play-modal');
    const statsModal = document.getElementById('stats-modal');
    const closeHowToPlayModal = document.getElementById('close-how-to-play-modal');
    const closeStatsModal = document.getElementById('close-stats-modal');

    // Stats Elements
    const statsPlayed = document.getElementById('stats-played');
    const statsWinRate = document.getElementById('stats-win-rate');
    const statsCurrentStreak = document.getElementById('stats-current-streak');
    const statsMaxStreak = document.getElementById('stats-max-streak');
    const statsChartCanvas = document.getElementById('stats-chart');
    let statsChart = null;


    // --- Game State ---
    let songs = [];
    let songTitles = [];
    let todaySong = null;
    let guessCount = 0;
    const MAX_GUESSES = 5;
    let gameOver = false;
    let gameWon = false;
    let snippetStartTime = 0;
    
    // Audio snippet durations (in seconds)
    const snippetDurations = [1, 2, 4, 8, 16]; 
    let currentSnippetIndex = 0;

    const STATS_KEY = 'liamiswashedle_stats'; // Renamed stats key

    // --- Mock Data ---
    const songsData = [
        {
            "id": "different",
            "title": "DIFFERENT",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/different-BgclrT515rAo9KlwXnoTgjEzfVdcD6",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/different.mp3"
        },
        {
            "id": "antifragile",
            "title": "ANTIFRAGILE",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20ANTIFRAGILE%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/antifragile"   
        },
        {
            "id": "nocelestial",
            "title": "No Celestial",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20ANTIFRAGILE%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/nocelestial"   
        },
        {
            "id": "thehydra",
            "title": "The Hydra",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20ANTIFRAGILE%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/The%20Hydra.mp3"   
        },
        {
            "id": "impurities",
            "title": "Impurities",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20ANTIFRAGILE%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/Impurities.mp3"   
        },
        {
            "id": "goodparts",
            "title": "Good Parts (when the quality is bad but I am)",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20ANTIFRAGILE%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/Good%20Parts%20%28when%20the%20quality%20is%20bad%20but%20I%20am%29.mp3"   
        },
        {
            "id": "blueflame",
            "title": "Blue Flame",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20FEARLESS%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/Blue%20Flame.mp3"   
        },
        {
            "id": "fearless",
            "title": "FEARLESS",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20FEARLESS%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/FEARLESS.mp3"   
        },
        {
            "id": "sourgrapes",
            "title": "Sour Grapes",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20FEARLESS%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/Sour%20Grapes.mp3"   
        },
        {
            "id": "thegreatmermaid",
            "title": "The Great Mermaid",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20FEARLESS%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/The%20Great%20Mermaid.mp3"   
        },
        {
            "id": "theworldismyoyster",
            "title": "The World Is My Oyster",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20FEARLESS%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/The%20World%20Is%20My%20Oyster.mp3"   
        },
        {
            "id": "eve",
            "title": "Eve, Psyche & The Bluebeard's wife",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20UNFORGIVEN%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/Eve%2C%20Psyche%20%26%20The%20Bluebeard%E2%80%99s%20wife.mp3"   
        },
        {
            "id": "fireinthebelly",
            "title": "Fire in the belly",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20UNFORGIVEN%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/Fire%20in%20the%20belly.mp3"   
        },
        {
            "id": "flashforward",
            "title": "Flash Forward",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20UNFORGIVEN%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/Flash%20Forward.mp3"   
        },
        {
            "id": "noreturn",
            "title": "No-Return (Into the unknown)",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20UNFORGIVEN%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/No-Return%20%28Into%20the%20unknown%29.mp3"   
        },
        {
            "id": "unforgiven",
            "title": "UNFORGIVEN (feat. Nile Rodgers)",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20UNFORGIVEN%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/UNFORGIVEN%20%28feat.%20Nile%20Rodgers%29.mp3"   
        },
        {
            "id": "fearnot",
            "title": "FEARNOT (Between you, me and the lamppost)",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20UNFORGIVEN%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/FEARNOT%20%28Between%20you%2C%20me%20and%20the%20lamppost%29.mp3"   
        },
        {
            "id": "burnthebridge",
            "title": "Burn the Bridge",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20UNFORGIVEN%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/Burn%20the%20Bridge.mp3"   
        },
        {
            "id": "choices",
            "title": "Choices",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20FEARLESS%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/Choices.mp3"   
        },
        {
            "id": "perfectnight",
            "title": "Perfect Night",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20Perfect%20Night%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/Perfect%20Night.mp3"   
        },
        {
            "id": "1800hotnfun",
            "title": "1-800-hot-n-fun",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20CRAZY%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/1-800-hot-n-fun.mp3"   
        },
        {
            "id": "chasinglightning",
            "title": "Chasing Lightning",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20CRAZY%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/Chasing%20Lightning.mp3"   
        },
        {
            "id": "crazier",
            "title": "Crazier",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20CRAZY%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/Crazier.mp3"   
        },
        {
            "id": "crazy",
            "title": "CRAZY",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20CRAZY%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/CRAZY.mp3"   
        },
        {
            "id": "pierrot",
            "title": "Pierrot",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20CRAZY%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/Pierrot.mp3"   
        },
        {
            "id": "easy",
            "title": "EASY",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20EASY%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/EASY.mp3"   
        },
        {
            "id": "goodbones",
            "title": "Good Bones",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20EASY%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/Good%20Bones.mp3"   
        },
        {
            "id": "swansong",
            "title": "Swan Song",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20EASY%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/Swan%20Song.mp3"   
        },
        {
            "id": "wegotsomuch",
            "title": "We go so much",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20EASY%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/We%20got%20so%20much.mp3"   
        },
        {
            "id": "smart",
            "title": "Smart",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20Smart%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/Smart.mp3"   
        },
        {
            "id": "starsigns",
            "title": "Star Signs",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20Star%20Signs%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/Star%20Signs.mp3"   
        },
        {
            "id": "ash",
            "title": "Ash",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20HOT%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/Ash.mp3"   
        },
        {
            "id": "bornfire",
            "title": "Born Fire",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20HOT%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/Born%20Fire.mp3"   
        },
        {
            "id": "comeover",
            "title": "Come Over",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20HOT%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/Come%20Over.mp3"   
        },
        {
            "id": "hot",
            "title": "HOT",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20HOT%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/HOT.mp3"   
        },
        {
            "id": "socynical",
            "title": "So Cynical (Badum)",
            "albumArt": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/art/Cover%20of%20HOT%20by%20LE%20SSERAFIM.jpg",
            "audioPath": "https://3nookayzsph3yok1.public.blob.vercel-storage.com/mp3/So%20Cynical%20%28Badum%29.mp3"   
        }

    ];

    // --- Initialization ---
    async function init() {
        songs = songsData;
        songTitles = songs.map(s => s.title);
        
        setupGameForToday();
        setupUI();
        setupEventListeners();
    }

    // --- Game Logic ---
    function getDayOfYear() {
        const now = new Date();
        const start = new Date(now.getFullYear(), 0, 0);
        const diff = now - start;
        const oneDay = 1000 * 60 * 60 * 24;
        return Math.floor(diff / oneDay);
    }

    function setupGameForToday() {
        /* // --- TEMPORARILY DISABLED FOR TESTING ---
        // This block enforces one song per day.
        const stats = getStats();
        const today = new Date().toISOString().split('T')[0];

        if (stats.lastPlayed === today) {
            todaySong = songs[stats.lastSongIndex];
            gameOver = true;
            gameWon = stats.lastGameWon;
            guessCount = stats.guesses.length > 0 ? stats.guesses[stats.guesses.length - 1] : 0;
            showResult(gameWon);
            for (let i = 0; i < guessCount; i++) {
                updateGuessVisualizer(gameWon && i === guessCount - 1, false);
            }
            return;
        }

        const dayIndex = getDayOfYear();
        const songIndex = dayIndex % songs.length;
        // --- END OF DISABLED BLOCK ---
        */

        // --- FOR TESTING: Select a random song on every reload ---
        const songIndex = Math.floor(Math.random() * songs.length);
        
        todaySong = songs[songIndex];
        
        const stats = getStats();
        stats.lastSongIndex = songIndex;
        saveStats(stats);

        prepareAudio();
    }
    
    function prepareAudio() {
        if (!todaySong || !todaySong.audioPath) {
            console.error("Today's song or audio path is not defined.");
            resultMessage.textContent = "Sorry, today's song could not be loaded.";
            gameContainer.innerHTML = "Please try again tomorrow.";
            return;
        }
        audioPlayer.src = todaySong.audioPath;
        audioPlayer.load();
    }

    function handleGuess(isSkip = false) {
        if (gameOver) return;

        let isCorrect = false;
        if (!isSkip) {
            const userGuess = guessInput.value.trim();
            if (!userGuess) return;
            isCorrect = userGuess.toLowerCase() === todaySong.title.toLowerCase();
        }
        
        updateGuessVisualizer(isCorrect, isSkip);
        guessCount++;

        if (isCorrect) {
            gameWon = true;
            endGame();
        } else if (guessCount >= MAX_GUESSES) {
            gameWon = false;
            endGame();
        } else {
            currentSnippetIndex++;
            guessInput.value = '';
            closeAutocomplete();
        }
    }

    function endGame() {
        gameOver = true;
        updateStats(gameWon, guessCount);
        showResult(gameWon);
    }
    
    function showResult(isWin) {
        audioPlayer.pause();
        audioPlayer.currentTime = 0;

        inputContainer.classList.add('hidden');
        resultContainer.classList.remove('hidden');

        if (isWin) {
            resultMessage.textContent = 'Congratulations!';
            resultMessage.classList.add('text-green-400');
        } else {
            resultMessage.textContent = 'Better luck next time!';
            resultMessage.classList.add('text-red-400');
        }
        correctSongTitle.textContent = `${todaySong.title}`;
        albumArtContainer.innerHTML = `<img src="${todaySong.albumArt}" alt="${todaySong.title}" class="w-40 h-40 rounded-lg shadow-lg border-2 border-slate-600">`;
        
        playPauseBtn.onclick = () => {
             if (audioPlayer.paused) {
                audioPlayer.play();
            } else {
                audioPlayer.pause();
            }
        };
    }

    // --- UI Updates ---
    function setupUI() {
        for (let i = 0; i < MAX_GUESSES; i++) {
            const square = document.createElement('div');
            square.className = 'w-8 h-8 md:w-10 md:h-10 bg-slate-700 rounded-md guess-square';
            guessesContainer.appendChild(square);
        }
    }
    
    function updateGuessVisualizer(isCorrect, isSkip) {
        const square = guessesContainer.children[guessCount];
        if (!square) return;

        square.classList.remove('bg-slate-700');
        if(isCorrect) {
             square.classList.add('bg-green-500');
             square.style.borderColor = 'rgba(34, 197, 94, 0.5)';
        } else if (isSkip) {
             square.classList.add('bg-gray-500');
             square.style.borderColor = 'rgba(107, 114, 128, 0.5)';
        } else {
            square.classList.add('bg-red-500');
            square.style.borderColor = 'rgba(239, 68, 68, 0.5)';
        }
    }

    function updateAudioProgress() {
        if (!audioPlayer.duration || !isFinite(audioPlayer.duration)) return;
        let currentProgress = 0;
        if(gameOver) {
            currentProgress = (audioPlayer.currentTime / audioPlayer.duration) * 100;
        } else {
            const snippetDuration = snippetDurations[currentSnippetIndex];
            const elapsed = audioPlayer.currentTime - snippetStartTime;
            currentProgress = (elapsed / snippetDuration) * 100;
        }
        progressBar.style.width = `${Math.min(100, Math.max(0, currentProgress))}%`;
    }

    function updatePlayButton() {
        if (audioPlayer.paused) {
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
        } else {
            playIcon.classList.add('hidden');
            pauseIcon.classList.remove('hidden');
        }
    }
    
    function showAutocomplete(input) {
        closeAutocomplete();
        if (!input) return;

        const filteredSongs = songTitles.filter(title => title.toLowerCase().includes(input.toLowerCase()));
        if (filteredSongs.length === 0) return;

        autocompleteList.classList.remove('hidden');
        filteredSongs.forEach(title => {
            const item = document.createElement('div');
            item.textContent = title;
            item.addEventListener('click', () => {
                guessInput.value = title;
                closeAutocomplete();
            });
            autocompleteList.appendChild(item);
        });
    }

    function closeAutocomplete() {
        autocompleteList.innerHTML = '';
        autocompleteList.classList.add('hidden');
    }

    // --- Stats Logic ---
    function getStats() {
        const stats = localStorage.getItem(STATS_KEY);
        if (stats) {
            return JSON.parse(stats);
        }
        return {
            gamesPlayed: 0,
            gamesWon: 0,
            currentStreak: 0,
            maxStreak: 0,
            guessDistribution: {1: 0, 2: 0, 3: 0, 4: 0, 5: 0},
            lastPlayed: null,
            lastGameWon: false,
            lastSongIndex: 0,
            guesses: []
        };
    }

    function saveStats(stats) {
        localStorage.setItem(STATS_KEY, JSON.stringify(stats));
    }

    function updateStats(won, guesses) {
        const stats = getStats();
        
        const today = new Date().toISOString().split('T')[0];
        // In testing mode, we don't check lastPlayed, but we still update stats.
        // For production, the check would be outside this function.
        
        stats.gamesPlayed++;
        stats.lastPlayed = today; // Still useful to set this
        stats.lastGameWon = won;
        stats.guesses.push(guesses);

        if (won) {
            stats.gamesWon++;
            stats.currentStreak++;
            if(stats.guessDistribution[guesses]) {
                stats.guessDistribution[guesses]++;
            } else {
                stats.guessDistribution[guesses] = 1;
            }
        } else {
            stats.currentStreak = 0;
        }

        if (stats.currentStreak > stats.maxStreak) {
            stats.maxStreak = stats.currentStreak;
        }

        saveStats(stats);
    }
    
    function displayStats() {
        const stats = getStats();
        statsPlayed.textContent = stats.gamesPlayed;
        statsWinRate.textContent = stats.gamesPlayed > 0 ? Math.round((stats.gamesWon / stats.gamesPlayed) * 100) : 0;
        statsCurrentStreak.textContent = stats.currentStreak;
        statsMaxStreak.textContent = stats.maxStreak;

        const chartData = {
            labels: ['1', '2', '3', '4', '5'],
            datasets: [{
                label: '# of Guesses',
                data: Object.values(stats.guessDistribution),
                backgroundColor: 'rgba(0, 191, 255, 0.6)',
                borderColor: 'rgba(0, 191, 255, 1)',
                borderWidth: 1,
                borderRadius: 4,
            }]
        };

        if(statsChart) {
            statsChart.destroy();
        }

        statsChart = new Chart(statsChartCanvas, {
            type: 'bar',
            data: chartData,
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { color: '#9ca3af', stepSize: 1 },
                        grid: { color: 'rgba(0, 191, 255, 0.1)' }
                    },
                    x: {
                        ticks: { color: '#9ca3af' },
                         grid: { display: false }
                    }
                },
                plugins: {
                    legend: { display: false }
                }
            }
        });
    }

    // --- Share Logic ---
    function generateShareResult() {
        let result = `🎧 LIAMISWASHEDLE #${getDayOfYear()}\n\n`; // Renamed
        for (let i = 0; i < guessCount; i++) {
            if (gameWon && i === guessCount - 1) {
                result += '🟩';
            } else {
                result += '⬛';
            }
        }
        for (let i = guessCount; i < MAX_GUESSES; i++) {
             result += '⬜';
        }
        
        result += `\n\n#TRASH`; // Renamed
        return result;
    }

    function copyToClipboard(text) {
        if (navigator.clipboard) {
            navigator.clipboard.writeText(text).then(() => {
                shareFeedback.textContent = 'Copied to clipboard!';
                setTimeout(() => shareFeedback.textContent = '', 2000);
            }).catch(err => {
                console.error('Could not copy text: ', err);
                fallbackCopyToClipboard(text);
            });
        } else {
            fallbackCopyToClipboard(text);
        }
    }
    
    function fallbackCopyToClipboard(text) {
        const textArea = document.createElement("textarea");
        textArea.value = text;
        textArea.style.position = "fixed";
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        try {
            document.execCommand('copy');
            shareFeedback.textContent = 'Copied to clipboard!';
            setTimeout(() => shareFeedback.textContent = '', 2000);
        } catch (err) {
            shareFeedback.textContent = 'Failed to copy!';
            setTimeout(() => shareFeedback.textContent = '', 2000);
            console.error('Fallback: Oops, unable to copy', err);
        }
        document.body.removeChild(textArea);
    }
    
    // --- Event Listeners ---
    function setupEventListeners() {
        playPauseBtn.addEventListener('click', () => {
            if (gameOver) {
                if (audioPlayer.paused) {
                    audioPlayer.play().catch(e => console.error("Error playing full song:", e));
                } else {
                    audioPlayer.pause();
                }
                return;
            }

            if (audioPlayer.paused) {
                audioPlayer.currentTime = snippetStartTime; 
                
                const snippetDuration = snippetDurations[currentSnippetIndex] * 1000;
                
                const playPromise = audioPlayer.play();
                if (playPromise !== undefined) {
                    playPromise.catch(error => console.error("Error playing snippet:", error));
                }
                
                setTimeout(() => {
                    if (!audioPlayer.paused) {
                       audioPlayer.pause();
                    }
                }, snippetDuration);
            } else {
                audioPlayer.pause();
            }
        });

        audioPlayer.addEventListener('play', updatePlayButton);
        audioPlayer.addEventListener('pause', () => {
            updatePlayButton();
            if (!gameOver) {
                // When a snippet auto-pauses, reset the progress bar for the next attempt.
                progressBar.style.width = '0%';
            }
        });
        audioPlayer.addEventListener('timeupdate', updateAudioProgress);
        
        audioPlayer.addEventListener('loadedmetadata', () => {
            if (audioPlayer.duration && isFinite(audioPlayer.duration) && audioPlayer.duration > 20) {
                snippetStartTime = Math.floor(Math.random() * (audioPlayer.duration - 20));
            } else {
                snippetStartTime = 0;
            }
            audioPlayer.currentTime = snippetStartTime;
        });

        audioPlayer.addEventListener('error', (e) => {
            console.error("Audio Player Error:", audioPlayer.error);
            resultMessage.textContent = "Sorry, an error occurred with the audio.";
            inputContainer.classList.add('hidden');
            resultContainer.classList.remove('hidden');

        });

        submitBtn.addEventListener('click', () => handleGuess(false));
        skipBtn.addEventListener('click', () => handleGuess(true));
        guessInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleGuess(false);
            }
        });
        
        guessInput.addEventListener('input', () => {
            showAutocomplete(guessInput.value);
        });

        document.addEventListener('click', (e) => {
            if (!document.querySelector('.autocomplete').contains(e.target)) {
                closeAutocomplete();
            }
        });

        shareBtn.addEventListener('click', () => {
            const resultText = generateShareResult();
            copyToClipboard(resultText);
        });

        // Modal Listeners
        howToPlayBtn.addEventListener('click', () => howToPlayModal.style.display = 'flex');
        closeHowToPlayModal.addEventListener('click', () => howToPlayModal.style.display = 'none');
        
        statsBtn.addEventListener('click', () => {
            displayStats();
            statsModal.style.display = 'flex';
        });
        closeStatsModal.addEventListener('click', () => statsModal.style.display = 'none');

        // Close modals on outside click
        window.addEventListener('click', (e) => {
            if (e.target == howToPlayModal) {
                howToPlayModal.style.display = 'none';
            }
            if (e.target == statsModal) {
                statsModal.style.display = 'none';
            }
        });
    }

    // --- Start the game ---
    init();
});
</script>
</body>
</html>